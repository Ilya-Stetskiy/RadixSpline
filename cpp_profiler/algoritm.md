# Пояснительная записка к RadixSpline
> Алгоритм в данный момент работает с парами данными формата индекс ключа(подряд, по порядку), и числовое значение ключа
## Алгоритм RadixSpline
RadixSpline представляет из себя сложную структуру для поиска, с двумя параметрами, состоит из двух основных частей: 
- GreedySplineCorridor -  Линейная апроксимация данных. 
  - Строится жадно, за один последовательный проход по данным, 
  Возвращает пары точек, которые задают начало и конец прямых, отличающихся от данных не более чем на заранее заданный параметр ***error***
        
  - Суть алгоритма: из первых двух точек данных делаем прямую. Далее точки добавляются по одной, последовательно. 
  При добавлении точки проверяется, можно ли перестроить прямую до неё так, чтобы прямая не вышла из доверительного диапазона. 
  Для этого для каждой точки строится коридор (значение +-ошибка) и сохраняются максимальный и минимальный угол таких "критических" прямых. 
  Если новая прямая, построенная при добавлении точки, превышает критические точки, значит она не подходит. 
  В таком случае предыдущая прямая заканчивается на пердыдущей точки, и начинается новая.
- Radix table - разреженный индекс, который ссылается на блок результата GreedySplineCorridor.

    Разделение на блоки по префиксу длины ***bitlengh***, это второй параметр для настройки RadixSpline
    В ячейках Radix Table лежат номера первых элементов, у которых префикс равен индексу ячейки

<table>
    <tr>
        <th>Индекс</th>
        <th>Ключ</th>
    </tr>
    <tr>
        <td>0</td>
        <td>00***</td>
    </tr>
    <tr>
        <td>1</td>
        <td>01***</td>
    </tr>
    <tr>
        <td>2</td>
        <td>10***</td>
    </tr>
    <tr>
        <td>3</td>
        <td>11***</td>
    </tr>
</table>

### Построение структуры
1) По данным строится GreedySplineCorridor.
2) По результату 1. строится индекс RadixTable

### Алгоритм поиска
1) Нахождение префикса полученного ключа
2) Переход к блоку данных по RadixTable 
3) Бинарный поиск внутри блока, для нахождения подходящей прямой апроксимации
4) Вычисление предположительной точки на прямой
5) Бинарный поиск по данным внутри диапазона ошибки



## Реализация
Greedy и RadixSpline реализованны отдельно, Greedy никак не зависит от Radix и может быть построен без Radix

### Greedy 
Строится жадно, данные в структуру добавляются функцией **new_spline**. Если структура пустая, происходит инициализация, где "критические прямые" уходят в бесконечность.
Затем, происходит проверка, описанная в алгоритме. Прямые представленны тангенсами углов. 
Поиск происходит по следующему алгоритму: пользователь вызывает get_key с парой ключ-значений (для проверки результата), в ней вызывается give_answer, которая возвращает предположительную точку на прямой, затем находится диапазон ошибки и проводится поиск внутри него
Результат (набор точек, образующие прямые) хранится в векторе greedyspline

Краткое описание реализованных функций: 
- new_spline функция добавление новых точек в структуру
- start установка начальных параметров 
- tg_spline функция для поиска тангенса угла наколна прямых
- new_coridor вычисляет коридор погрешности
- bin_search результат последнего бинарного поиска, итоговый результат поиска
- bin_search_spline бинарный поиск внутри блока, для нахождения подходящей прямой апроксиимации
- get_key функция для поиска элемента в структуре, с встроенной проверкой результата поиска (временно)
- give_answer поиск предположительной точки на прямой апроксимации

### Radix
Строится функцией get_RadixSpline за проход по вектору greedyspline, находя префиксы каждого элемента, и добавляя новые в разреженный индекс. 
Затем проходится в обратном порядке, заполняя пустые ячейки.

Сейчас реализованно следующее улучшение radixSpline: в случае, если все данные имеют одинаковый префикс, он находится функцией not_prefix_count, и в дальнейшем эта часть префикса не учитывается

При поиске элемента (get_key) вызывается give_ansver, которая находит необходимый блок апроксимирующих прямых  и вызывает поиск по данному блоку фунции выбранного сплайна, затем находится диапазон ошибки, и происходит поиск в нем.

Краткое описание реализованных функций:
- get_RadixSpline построение сплайна
- bit_length Находит длину числа в битовом формате
- not_prefix_count нахождение повторяющейся части в префиксе
- first_bits вычисление префикса
- give_answer нахождение блока прямых, вызов поиска внутри него
- get_key функция поиска

Помимо этого реализованна фукнция get_spline для генерации сплайнов.